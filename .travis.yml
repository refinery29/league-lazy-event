language: php

sudo: false

env:
  global:
    - secure: "SMZTImMPpF8+5jAVUWldFh9FStxUOwOF0nw9KXijL+bVDFsfSYqot08kEO9w/B6YJVo5RNvmxmOPs3KQwyVayCjOgHwd2TRcGU/rmdyn1j9hwboI9jnPUiLHF3k65cOFqDwfhHMuRik9ikGlB/U/ghzh1djPRQtHUPzfYC2MPQmTKxrkPiB9fV2EmPoM1u7/pYZVg3+XHjVetoFgwgkxQp28SJ2HnTKoU3YRYzgjsKxJKBgnZQ7ghqXbXphPfG78fXhT6CNjN/ZlT5sqOQnaGLo9PHPZNhD45W8c5HPWrfgY+Rdf38v4LIimdULfTNffqWO9XI4MIgsIKLt6zsA+TfqZggwZf9ZezbttzebPXjhNUiD63tAiCiAz0tsNPTX9nNT4eICSQ0LbClxddyRUcH3A2Yw1N0SLIdG18nqHFh0wn1qlMvFqo0H62odxmyfwnI4iPQreYps1OPO2OV30YaE0WqL4+JeI4/sXmyu79upB0Q+mZlVWmv5HEgZ0YEeva4Idp2Oodxb0Ih2MuvnTdZcRjj/MvRqUn770pGdtspyQSvfTv4WopeV9gwUeqNpAMg4D8kXDl0iaYsK5BwyKB74MFb8OoNC0RByoQwQgp4nXQkNXQh0/Lh6YQL+OlMRESbWLVBUh9fVTapv6MRkk1SwUdwoJ3JZzY+QFGNZT2z8="
    - secure: "L3BqqRn7499D9Y2DqpwHsaN5RCiuHDb5fcS3lazJnVoQ49apAUrvWb5BAAISJjzAPQv5lNJIBP6spKQs7CW0kec+xb4Iqb416OVAwPzf2SNtchu8pViKsePhr1SYS9L0XBq5bFLmKDPhUefTaPoC0nLbq76XQFkdDc1Be/hDxSqFAiswV02pNv7B1Pd4G+IyqCxhtFLBOdcXB5rNbNNwmiq35JCL4iT0tHt76r0dVOVcwzFUq+NOILwOjRfRqFlGCELt57RBgccZevmx9Iht4j91AZV1o53+RxHuMvLraDHeBUYGzC4UQHFMgtmb5IyyoEB6RzlsLEOyBod9bfY2ZGohSEeRse7v7IAtm2GpjJlzsp46V757omgQ3KROkoNSqMAuMUcqfsZt00O65RlbyC0kloq/vD6rAwvUsvjmSn8jMiFlxwbCXiFE8dHuc2UBkLeLmw1ptII6+ljWhljg7Upf9WPepEi6vNVHsmYluUutA/cELm0OZadejQO2j4QKb0xfsz5Dfuvcyf8zN8ER1zQUWuNah1qAoUhCgsAbGgwiXXucl9BJkwjmPZdI9AEGS7BeW2KMDOKmqG7+vfYsLoFd07HV/6ikI7ai37wqtinHM69wVOG5+DD21pmsBleDEDv6YiVzRV7iGXxlJIti/+CYJs36WywcoPYvYDtkfPM="

matrix:
  fast_finish: true
  include:
    - php: 5.5
    - php: 5.6
    - php: 7.0
      env: WITH_CS=true
    - php: 7.1
      env: WITH_COVERAGE=true

cache:
  directories:
    - $HOME/.composer/cache
    - $HOME/.php-cs-fixer

before_install:
  - if [[ "$WITH_COVERAGE" != "true" && "$TRAVIS_PHP_VERSION" != "hhvm" ]]; then phpenv config-rm xdebug.ini; fi
  - composer self-update
  - composer validate
  - composer config github-oauth.github.com $GITHUB_TOKEN

install:
  - composer install --prefer-dist

before_script:
  - mkdir -p "$HOME/.php-cs-fixer"
  - mkdir -p build/logs

script:
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/phpunit --configuration=test/Unit/phpunit.xml --coverage-clover=build/logs/clover.xml; else vendor/bin/phpunit --configuration=test/Unit/phpunit.xml; fi
  - if [[ "$WITH_CS" == "true" ]]; then vendor/bin/php-cs-fixer fix --config=.php_cs --verbose --diff --dry-run; fi

after_success:
  - if [[ "$WITH_COVERAGE" == "true" ]]; then vendor/bin/test-reporter --coverage-report=build/logs/clover.xml; fi

notifications:
  email: false
